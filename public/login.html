<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Asta Panel ü¶Ö</title>
    <meta name="theme-color" content="#0ea5e9" />
    <link rel="icon" href="https://files.catbox.moe/bzkzuc.jpg" />
    <link rel="stylesheet" href="styles/style.css" />
    <script>
      (function () {
        try {
          const stored = localStorage.getItem("theme");
          const prefersDark =
            window.matchMedia &&
            window.matchMedia("(prefers-color-scheme: dark)").matches;
          const theme = stored || (prefersDark ? "dark" : "light");
          document.documentElement.setAttribute("data-theme", theme);
        } catch (e) {}
      })();
    </script>
  </head>
  <body>
    <div id="notification-container"></div>
    <div class="overlay"></div>
    <header>
      <img class="logo" src="https://files.catbox.moe/bzkzuc.jpg" alt="Logo" />
      <div style="font-size: 22px; font-weight: 700; letter-spacing: 0.3px">
        Asta Panel ü¶Ö
      </div>
      <button
        id="theme-toggle"
        class="theme-toggle"
        type="button"
        aria-pressed="false"
        title="Ganti tema"
      >
        <span id="theme-icon" aria-hidden="true">üåô</span>
      </button>
    </header>
    <main>
      <div class="card" id="login-card">
        <h2>Masuk</h2>
        <p class="subtitle">Silakan masuk untuk mengelola panel Anda</p>
        <form id="login-form" novalidate>
          <div class="form-group">
            <label for="username">Username</label>
            <input
              type="text"
              id="username"
              name="username"
              placeholder="Masukkan username"
              autocomplete="username"
              required
            />
          </div>
          <div class="form-group">
            <label for="password">Password</label>
            <input
              type="password"
              id="password"
              name="password"
              placeholder="Masukkan password"
              autocomplete="current-password"
              minlength="6"
              required
            />
            <div class="helper">Minimal 6 karakter.</div>
            <div
              id="login-error"
              class="error"
              role="alert"
              aria-live="polite"
              style="display: none"
            ></div>
          </div>
          <div class="form-group">
            <button id="login-btn" type="submit">Masuk</button>
          </div>
        </form>
      </div>
    </main>
    <footer>¬© <span id="y"></span> Asta Panel ü¶Ö ¬∑ Dibuat dengan ‚ù§</footer>

    <script>
      document.getElementById("y").textContent = new Date().getFullYear();

      function showToast(message, type = "success") {
        const container = document.getElementById("notification-container");
        const toast = document.createElement("div");
        toast.className = `toast ${type}`;
        toast.textContent = message;

        container.appendChild(toast);

        setTimeout(() => {
          toast.classList.add("show");
        }, 100);

        setTimeout(() => {
          toast.classList.remove("show");
          toast.addEventListener("transitionend", () => toast.remove());
        }, 5000);
      }

      const metaTheme = document.querySelector('meta[name="theme-color"]');
      const themeToggleBtn = document.getElementById("theme-toggle");
      const themeIcon = document.getElementById("theme-icon");
      const themeLabel = document.getElementById("theme-label");

      function applyThemeUI(theme) {
        const isDark = theme === "dark";
        themeToggleBtn.setAttribute("aria-pressed", String(isDark));
        themeIcon.textContent = isDark ? "‚òÄÔ∏è" : "üåô";
        if (metaTheme)
          metaTheme.setAttribute("content", isDark ? "#0b1220" : "#e6f0ff");
      }

      function getCurrentTheme() {
        return document.documentElement.getAttribute("data-theme") || "light";
      }

      function setTheme(theme) {
        document.documentElement.setAttribute("data-theme", theme);
        try {
          localStorage.setItem("theme", theme);
        } catch (e) {}
        applyThemeUI(theme);
      }

      applyThemeUI(getCurrentTheme());

      themeToggleBtn.addEventListener("click", function () {
        const current = getCurrentTheme();
        const next = current === "dark" ? "light" : "dark";
        setTheme(next);
      });

      const loginForm = document.getElementById("login-form");
      const loginBtn = document.getElementById("login-btn");
      const loginError = document.getElementById("login-error");

      loginForm.addEventListener("submit", async function (e) {
        e.preventDefault();
        loginError.style.display = "none";
        loginError.textContent = "";

        const userInput = document.getElementById("username");
        const passInput = document.getElementById("password");
        const user = userInput.value.trim();
        const pass = passInput.value;

        if (!user) {
          loginError.textContent = "Username wajib diisi.";
          loginError.style.display = "block";
          userInput.focus();
          return;
        }
        if (!pass || pass.length < 6) {
          loginError.textContent = "Password minimal 6 karakter.";
          loginError.style.display = "block";
          passInput.focus();
          return;
        }

        loginBtn.disabled = true;
        loginBtn.textContent = "Memproses‚Ä¶";
        loginBtn.setAttribute("aria-busy", "true");

        try {
          const authUser = await fetch("/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username: user, password: pass }),
          });
          const data = await authUser.json();
          if (data.status) {
            localStorage.setItem("username", user);
            showToast("Login berhasil! Mengalihkan...", "success");

            if (data.isAdmin) {
              sessionStorage.setItem("adminAuth", "true");
              sessionStorage.setItem("creatorRole", "admin_website");
              window.location.href = "admin"; // Admin Website ke /admin
            } else {
              if (data.role) {
                try {
                  sessionStorage.setItem("creatorRole", data.role);
                } catch (e) {}
              }
              
              // --- [INI PERBAIKANNYA] ---
              // SEMUA role non-admin (CEO, Reseller, dll) diarahkan ke /panel
              window.location.href = "/panel"; 
              // --------------------------
            }
          } else {
            loginError.textContent =
              data.message || "Username atau password salah!";
            loginError.style.display = "block";
          }
        } catch (err) {
          loginError.textContent = "Terjadi kesalahan jaringan. Coba lagi.";
          loginError.style.display = "block";
        } finally {
          loginBtn.disabled = false;
          loginBtn.textContent = "Masuk";
          loginBtn.removeAttribute("aria-busy");
        }
      });
      localStorage.clear();
    </script>
  </body>
</html>